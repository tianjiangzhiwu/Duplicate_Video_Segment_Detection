# 视频重复片段检测与自动删除工具 - KIMI版

一款强大的视频重复内容检测工具，能够精准识别视频中的重复片段，并提供自动删除功能，帮助用户快速清理视频库中的重复内容。

## 🔥 主要功能

### 1. 智能重复检测
- 基于深度学习特征匹配，准确识别视频重复片段
- 支持多种视频格式（MP4, AVI, MKV, MOV等）
- 高精度算法，可检测微小的重复内容

### 2. 丰富的可视化预览
- 从原来的3个缩略图增加到5个缩略图
- 在HTML报告中展示重复片段的关键帧
- 显示时间戳和相似度信息

### 3. 智能删除指南
- 自动生成视频删除指南，帮助用户决定保留哪个视频
- 基于视频分辨率判断，优先保留高质量视频
- 提供具体的删除时间范围建议

### 4. 自动视频编辑
- 根据删除指南自动删除重复片段
- 支持批量处理多个视频
- 保留原始视频质量，仅删除重复部分

### 5. 用户友好的配置向导
- 交互式配置，简化视频目录设置
- 支持相对路径和绝对路径
- 自动检查环境和依赖项

## 📋 使用方法

### 完整流程
1. 将视频文件放入指定目录
2. 运行主程序: `python main.py`
3. 程序会自动执行:
   - 特征提取
   - 构建索引
   - 搜索重复片段
   - 生成报告
   - 生成删除指南
   - （可选）自动删除重复片段

### 配置视频目录
如果你需要更改视频目录，可以运行配置向导：
```bash
python main.py --config
```

### 手动自动删除模式
如果你想跳过确认直接执行删除，可以运行：
```bash
python main.py --auto-delete
```

### 单独生成删除指南
如果你想在检测完成后单独生成删除指南，可以运行:
```bash
python generate_deletion_guide.py
```

## ⚙️ 配置选项

你可以在 `config.py` 中调整以下参数：

- `VIDEO_DIR`: 视频文件所在目录路径
- `SIMILARITY_THRESHOLD`: 相似度阈值（0.85-0.95），值越大越严格
- `MIN_DUPLICATE_DURATION`: 最小重复片段长度（秒），避免检测太短的重复片段
- `SAMPLE_INTERVAL`: 每秒采样帧数，越小越精确但处理越慢
- `DEVICE`: 处理设备（自动检测CUDA支持）

## 📁 输出文件

运行后会在相应目录下生成：

**Cache目录 (`cache/`)**:
- `features.npy`: 提取的视频特征数据
- `metadata.json`: 视频元数据信息

**输出目录 (`output/`)**:
- `report.html`: 可视化报告，包含5个缩略图预览
- `duplicates.json`: 重复片段详细数据
- `deletion_guide.json`: 结构化删除指南（JSON格式）
- `deletion_guide.txt`: 删除指南（文本格式）

## 🚀 技术特点

- **GPU加速**: 自动检测并利用CUDA进行加速处理
- **智能路径解析**: 能够处理各种路径格式和编码问题
- **音频保留**: 删除重复片段时尽可能保留原始音频
- **安全处理**: 先生成临时文件，确认后再替换原文件

## 🛠️ 依赖库

项目使用以下Python库：
- `numpy`: 数值计算
- `opencv-python`: 视频处理
- `torch`: 深度学习框架
- `faiss-cpu`: 高效相似性搜索
- `tqdm`: 进度条显示
- `ffmpeg-python`: 视频编码处理

## 📝 注意事项

1. 程序会自动检测是否安装了所需的依赖库
2. 如果有GPU支持，处理速度会更快
3. 生成的删除指南仅作参考，最终删除决策由用户决定
4. 建议在删除视频前先备份重要数据
5. 自动删除功能会在处理前要求用户确认
6. 处理大型视频文件可能需要较长时间

## 💡 使用技巧

- 调整 `SIMILARITY_THRESHOLD` 参数来控制检测灵敏度
- 使用较低的 `SAMPLE_INTERVAL` 值可提高准确性但会增加处理时间
- 为获得最佳效果，确保视频文件路径不包含特殊字符
- 对于大量视频文件，建议分批处理

## 🤝 贡献

本工具是开源项目，欢迎提交issue和pull request。